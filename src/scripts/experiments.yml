# Principles of formatting each 'command' in 'jobs':
# 1. expand macros; 2. expand variables defined in a single matrix element;
# 3. expand meta; 4. the remaining variables need to be filled in run.py.

meta:
  branch: dev
  base_dir: ~/pantheon
  data_dir: ~/pantheon/data
  install_deps_path: ~/pantheon/tools/install_deps.sh
  pkill_path: ~/pantheon/tools/pkill.py
  setup_system_path: ~/pantheon/src/experiments/setup_system.py
  setup_path: ~/pantheon/src/experiments/setup.py
  test_path: ~/pantheon/src/experiments/test.py
  traces_dir: ~/observatory/traces

real_world:
  matrix:
    sender_side:
      - --sender local
      - --sender remote
    flow_scenario:
      - -f 1
      - -f 3 --interval 10
  macros:
    common_param_set: >-
      remote {slave_addr}:{base_dir} --all --random-order -t 30
      --data-dir {data_dir} --pkill-cleanup --tunnel-server local
      --local-addr {master_ip} --local-desc "{master_desc}"
      --remote-desc "{slave_desc}" --ntp-addr {ntp_addr}
  jobs:
    # cellular (run only if ppp0 is up)
    - command: >-
        {test_path} {common_param_set} --run-times 3
        {sender_side} {flow_scenario} --remote-if ppp0 >> {job_log} 2>&1
    - command: >-
        {test_path} {common_param_set} --run-times 10
        {sender_side} {flow_scenario} >> {job_log} 2>&1
